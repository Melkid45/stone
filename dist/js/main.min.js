/**
 * @name		Shuffle Letters
 * @author		Martin Angelov
 * @version 	1.0
 * @url			http://tutorialzine.com/2011/09/shuffle-letters-effect-jquery/
 * @license		MIT License
 */
!function(e){function t(e){var t="";"lowerLetter"==e?t="abcdefghijklmnopqrstuvwxyz0123456789":"upperLetter"==e?t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789":"symbol"==e&&(t=",.?/\\(^)![]{}*&^%$#'\"0123456789");var o=t.split("");return o[Math.floor(Math.random()*o.length)]}e.fn.shuffleLetters=function(o){var r=e.extend({step:4,fps:35,text:"",callback:function(){}},o);return this.each((function(){var o=e(this),n="";if(o.data("animated"))return!0;o.data("animated",!0),n=r.text?r.text.split(""):o.text().split("");for(var i=[],s=[],a=0;a<n.length;a++){var c=n[a];" "!=c?(/[a-z]/.test(c)?i[a]="lowerLetter":/[A-Z]/.test(c)?i[a]="upperLetter":i[a]="symbol",s.push(a)):i[a]="space"}o.html(""),function e(a){var c,l=s.length,d=n.slice(0);if(a>l)return o.data("animated",!1),void r.callback(o);for(c=Math.max(a,0);c<l;c++)c<a+r.step?d[s[c]]=t(i[s[c]]):d[s[c]]="";o.text(d.join("")),setTimeout((function(){e(a+1)}),1e3/r.fps)}(-r.step)}))}}(jQuery),document.querySelector(".about")&&$(".about-attr .item span").each((function(e){let t=$(this).text();$(this).text(""),setTimeout((()=>{$(this).shuffleLetters({text:t,stepDelay:30,timeOffset:50})}),300*e)}));let scrollTrigger,lastTime=performance.now(),frameCount=0;function monitorPerformance(){const e=performance.now();frameCount++;const t=Math.round(1e3*frameCount/(e-lastTime));console.log("FPS:",t),e-lastTime>=1e3&&(frameCount=0,lastTime=e)}ScrollTrigger.config({limitCallbacks:!0,ignoreMobileResize:!0,autoRefreshEvents:"visibilitychange,DOMContentLoaded,load"});const lenis=new Lenis({autoRaf:!0,lerp:.1,smoothTouch:!1});let isDesktop=$(window).width()>780;function raf(e){lenis.raf(e),e%2==0&&ScrollTrigger.update(),requestAnimationFrame(raf)}requestAnimationFrame(raf);let resizeTimeout,heightFooter=document.querySelector(".footer").clientHeight;function updateMarqueeAnimation(){const e=document.getElementById("marqueeContainer"),t=document.querySelectorAll(".showreel-partners-stroke");if(!e||0===t.length)return;const o=t[0].scrollWidth,r=e.parentElement.offsetWidth,n=-(o+(parseFloat(getComputedStyle(e).gap)||0))/r*100;let i=document.getElementById("dynamic-marquee");i||(i=document.createElement("style"),i.id="dynamic-marquuee",document.head.appendChild(i)),i.innerHTML=`\n        @keyframes animPartners {\n            0% { \n                transform: translateX(0);\n                opacity: 1;\n            }\n            95% {\n                opacity: 1;\n            }\n            100% { \n                transform: translateX(${n}%);\n                opacity: 1;\n            }\n        }\n        \n        .stroke {\n            animation-fill-mode: both;\n        }\n    `,e.style.animation="none",setTimeout((()=>{e.style.animation=""}),10)}function debouncedUpdate(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout(updateMarqueeAnimation,250)}if($("body").css({"padding-bottom":heightFooter}),lenis.raf(0),$(".works__body-information-choose button").on("click",(function(){let e=$(this).index();$(this).addClass("current"),$(".works__body-information-choose button").not(this).removeClass("current"),$(".works-frame-sction").each((function(t){$(this).index()==e?$(this).addClass("current"):$(this).removeClass("current")}))})),document.getElementById("marqueeContainer")?.addEventListener("animationiteration",(function(){this.style.opacity="1"})),document.addEventListener("DOMContentLoaded",(function(){setTimeout(updateMarqueeAnimation,1e3),updateMarqueeAnimation()})),window.addEventListener("resize",debouncedUpdate),document.querySelector(".celebrities")){new Splide(".celebrities-splide",{type:"loop",perMove:1,pagination:!1,arrows:!1,autoplay:!0,interval:3e3,pauseOnHover:!1}).mount()}isDesktop?($(".header-menu-open").on("click",(function(e){$(".header__menu").addClass("opened")})),$(".navigation-close").on("click",(function(e){$(".header__menu").removeClass("opened")}))):$(".header-menu-open").on("click",(function(e){$(".header__menu").toggleClass("opened"),$(this).toggleClass("opened")})),window.addEventListener("load",(()=>{lenis.scrollTo(0,{immediate:!0})}));let lastScrollTop=0,isScrollingDown=!1;const scrollThreshold=5,activationThreshold=50;if(lenis.on("scroll",(({scroll:e})=>{ScrollTrigger.update(),currentScroll=e;const t=document.querySelector(".header");currentScroll>=2e3&&document.querySelector(".showreel")&&isDesktop?$(".footer").css({bottom:0}):currentScroll<2e3&&document.querySelector(".showreel")&&isDesktop&&$(".footer").css({bottom:"-100%"}),Math.abs(currentScroll-lastScrollTop)>5&&(isScrollingDown=currentScroll>lastScrollTop,lastScrollTop=currentScroll),isScrollingDown&&currentScroll>50?t.classList.add("back"):t.classList.remove("back")})),document.querySelector(".team-splide")){var splide=new Splide(".team-splide",{type:"loop",perPage:4,perMove:1,pagination:!1});splide.mount()}let AnimItems=document.querySelectorAll(".transform-item");gsap.set(document.querySelectorAll(".transform-item img, .transform-item video"),{yPercent:-10}),gsap.utils.toArray(AnimItems).forEach(((e,t)=>{let o=e.querySelector("img, video");o&&gsap.to(o,{yPercent:10,duration:1,ease:"expo.InOut",scrollTrigger:{trigger:e,start:"top bottom",end:"+=200%",scrub:!0}})}));const itemTweens={};$(".project-filter-main button").on("click",(function(e){let t=$(this).index();$(this).addClass("current").siblings().removeClass("current"),$(".project-filter-soft .item").each((function(e){const o=$(this),r=o.index(),n=o.find("button");itemTweens[r]&&itemTweens[r].kill(),r===t?(o.addClass("current"),itemTweens[r]=gsap.to(n,{opacity:.6,duration:.6,stagger:.2,ease:"sine.out",overwrite:"auto",onComplete:function(){n.first().addClass("current")}})):(o.removeClass("current"),n.removeClass("current"),gsap.set(n,{opacity:0}))}))})),$(".project-filter-soft button").on("click",(function(e){$(this).toggleClass("current")}));let ButtonsItem=document.querySelectorAll(".project-filter-soft .item");gsap.utils.toArray(ButtonsItem).forEach(((e,t)=>{let o=e.querySelectorAll("button");0!=t&&gsap.set(o,{opacity:0})})),$(".list-item").on("click",(function(e){$(this).hasClass("current")?($(this).next(".list-item").addClass("current"),$(this).removeClass("current"),0==$(this).next(".list-item").length&&($(this).removeClass("current"),$(".list-item").first().addClass("current"))):($(this).addClass("current"),$(".list-item").not(this).removeClass("current"))}));let orderWindow=document.querySelector(".order");$(".order-open").on("click",(function(e){$(".order").fadeIn(300)})),$(".close-order").on("click",(function(e){$(".order").fadeOut(300)})),document.addEventListener("DOMContentLoaded",(function(){const e="ontouchstart"in window||navigator.maxTouchPoints>0,t=document.querySelectorAll(".work, .services-frame-item, .project-wrap .item, .our-services-frame .item"),o=new Map,r=new Map;function n(e){const t=e.querySelector("source"),o=t?.dataset.src||e.src;o&&function(e){return new Promise(((t,o)=>{if(r.has(e))return t(r.get(e));const n=document.createElement("video");n.src=e,n.muted=!0,n.playsInline=!0,n.preload="auto",n.addEventListener("loadeddata",(()=>{try{const o=document.createElement("canvas");o.width=n.videoWidth,o.height=n.videoHeight,o.getContext("2d").drawImage(n,0,0,o.width,o.height);const i=o.toDataURL("image/jpeg",.8);r.set(e,i),t(i)}catch(e){o(e)}}),{once:!0}),n.addEventListener("error",o,{once:!0})}))}(o).then((t=>{e.setAttribute("poster",t)})).catch((()=>{}))}function i(e){return new Promise((t=>{e.readyState>=3?e.play().then(t).catch(t):e.addEventListener("canplaythrough",(()=>e.play().then(t).catch(t)),{once:!0})}))}t.forEach((function(t){const r=t.querySelectorAll(".preview-video, .services-video");if(!r.length)return;let s=null;r.forEach((t=>{const r=t.querySelector("source"),i=r?.dataset.src;i&&(o.has(i)?t.src=o.get(i).src:(t.src=i,o.set(i,t))),t.load(),t.pause(),t.currentTime=0,e||t.classList.remove("show-video"),n(t)}));const a=e=>{e&&(e.pause(),e.currentTime=0,e.classList.remove("show-video"),t.setAttribute("data-video-playing","false"),s===e&&(s=null))};e||(t.addEventListener("mouseenter",(()=>{const e=t.querySelector(".show-video")||r[0];var o;o=e,s&&s!==o&&a(s),o.muted=!0,i(o),o.classList.add("show-video"),t.setAttribute("data-video-playing","true"),s=o})),t.addEventListener("mouseleave",(()=>{s&&a(s)})))})),$(".information-tags-tag").on("click",(function(){const t=$(this).index();$(this).addClass("current").siblings().removeClass("current");const r=$(this).closest(".services-frame-item")[0].querySelectorAll(".wrap-services-video video");r.forEach(((s,a)=>{const c=s.querySelector("source"),l=c?.dataset.src;a===t?(r.forEach((e=>{e!==s&&(e.pause(),e.classList.remove("show-video"))})),$(s).addClass("show-video"),!s.src&&l&&(s.src=o.get(l)?.src||l,o.set(l,s),s.load(),n(s)),e||(s.muted=!0,i(s))):(s.pause(),$(s).removeClass("show-video"))}))}))}));let isPriorityVideoLoaded=!1,isPageReady=!1;if(document.querySelector(".preloader")){function isMobileDevice(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}function tryStartAnimation(){isPriorityVideoLoaded&&isPageReady&&runPreloaderAnimation()}function checkPreloaderLoad(){const e=document.querySelector(".showreel__body-video");let t=!1;if(setTimeout((()=>{t=!0,isPriorityVideoLoaded||(console.warn("Timeout reached → продолжаем без видео"),t&&(isPriorityVideoLoaded=!0,tryStartAnimation()))}),7e3),e)if(e.readyState>=4)isPriorityVideoLoaded=!0,tryStartAnimation();else{try{e.load()}catch(e){}const t=()=>{isPriorityVideoLoaded=!0,tryStartAnimation(),e.removeEventListener("canplaythrough",t),e.removeEventListener("error",t)};e.addEventListener("canplaythrough",t),e.addEventListener("error",t),isMobileDevice()&&0===e.readyState&&setTimeout((()=>{isPriorityVideoLoaded||(console.warn("iOS video load issue → запускаем без него"),isPriorityVideoLoaded=!0,tryStartAnimation())}),4e3)}else isPriorityVideoLoaded=!0,tryStartAnimation()}window.addEventListener("load",(()=>{isPageReady=!0,tryStartAnimation()}));function runPreloaderAnimation(){const e=gsap.timeline({defaults:{ease:"power2.inOut"}});e.to(".last-text",{clipPath:"inset(0 0% 0 0)",duration:1,ease:"power1"}),e.to(".preloader",{opacity:0,duration:.8,delay:.5,onComplete:()=>document.querySelector(".preloader").style.display="none"})}checkPreloaderLoad()}let showreel=document.querySelector(".showreel__body-wrap"),showreelVideo=document.querySelector(".showreel__body-video"),body=document.querySelector("body");showreel&&isDesktop&&($(".footer").css({bottom:"-100%"}),gsap.to(body,{background:"#242323",scrollTrigger:{trigger:showreel,scrub:!0,start:"top +=30%",end:"+=30%"}}),gsap.to(showreelVideo,{yPercent:-27,scale:.85,ease:"power1",duration:1,scrollTrigger:{trigger:showreel,scrub:!0,start:"top +=30%",end:"+=40%"}}),gsap.to(body,{scrollTrigger:{trigger:showreel,scrub:!0,start:"top +=30%",end:"+=200%",pin:!0,pinSpacer:!1}})),$(".accordion").on("click",(function(e){$(this).toggleClass("open")})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll("img[data-src]"),t=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){const o=e.target,r=o.dataset.src;r&&(o.src=r,o.removeAttribute("data-src")),t.unobserve(o)}}))}),{rootMargin:"400px 0px",threshold:0});e.forEach((e=>t.observe(e)))}));